%!TEX root = ../my_thesis.tex
\chapter{Techniques for fast z feedback}

Implementing model based controller or high frequency actuators improves the AFM feedback loop\cite{sulchek1999dual}. The drawback with these actuators is the decrease in the positioning range.

We improve the bandwidth and the scan range of our device. Past research has introduced an external piezoelectrical actuator on top of the cantilever. With this scheme, we can combine the advantages of a high bandwidth from the piezo-electrical actuator and the long range of the tip.

\section{Double PID}

The principal feature of an AFM is it's probing system. \cite{jeong:093706} The feedback control system is designed to adjust the motion of the tip on the z-axis. It will adjust the tip-to-sample distance. 

We have developed a dual-actuator control system. We put a piezo-electrical ceramics on top of the X-Y scanner. This device will work with the scanner to achieve a larger bandwidth. Indeed, it picks up high spatial frequency topography. 

\begin{figure}[H]
  \centering
  \includegraphics[scale=0.3]{images/doublePID.eps}
    \caption{Double PID}
  \label{DoublePid}
\end{figure}

We need a high-voltage amplifier to operate the small piezoelectric device. 

\section{Tilt compensation}

In theory, the mounted sample should be flat: parallel to the XY-Scanner. If the probe/sample angle is not perpendicular, we observe a tilt on the surface. This tilt is problematic when it becomes larger than the features. There are multiple ways to compensate for this. The most common technique is to use post-processing to adjust the image. Flattening algorithms or first-order planef itting restore the image and put the data on the same level. This technique works if the range of the tip is large enough. We have decided to take another approach and to dynamically compensate for the tilt. Before performing our scan, we will do a first scan to compute the tilt of the sample by considering our tilt as a 3D plane. Then, we'll generate a tilt correction signal that will be added to z scan output.

We use a circle pattern to scan the surface of the sample. The radius of the circle is equal to the scan size. It gives us informations about the general topography of the surface. Then, we compute the plane equation of the surface by applying a fit in Igor Pro. This fit will generate a plane that models the tilted surface. The input of this fit are the theoretical X-Y output waves of the circle pattern: a sinus and a cosines. The data on the z axis is the height.

\begin{equation}\label{eqn:planeeq}
z = a_1 x + a_2 y + a_3 
\end{equation}

The coefficients by minimizing the values of Chi-Square (error function). Then, we generate the waves to send to the controller the following way.

\begin{equation}\label{eqn:sendwave}
wavetosend = a_1 wavex + a_2 wavey 
\end{equation}

Wavex and wavey are the output of our scan pattern. With this method, we can do a tilt correction with any scan pattern.


\subsection{Experiment}

Wavex and wavey are the x,y components of our scan pattern. The scan pattern for an Archimedean spiral is defined by the equation  ~\ref{eqarchimedean}.

\begin{equation}\label{eqarchimedean}
x(t)= \alpha \sqrt{t} cos(\beta \sqrt{t})\\
y(t)= \alpha \sqrt{t} sin(\beta \sqrt{t})
\end{equation}

We took a calibration sample to test the efficiency of our method. The size or our scan is 30 $\mu m$. We see on the figure  ~\ref{spiraheight30uv2} that the surface has a tilt. The small spikes on the curve represent the pyramids on the sample.

\begin{figure}[ht]
\begin{minipage}[b]{0.45\linewidth}
\centering
\includegraphics[width=\textwidth]{images/spiraheight30uv2.eps}
\caption{Height of the tilt correction}
\label{spiraheight30uv2}
\end{minipage}
\hspace{0.5cm}
\begin{minipage}[b]{0.45\linewidth}
\centering
\includegraphics[width=\textwidth]{images/xsenvsysen30u.eps}
\caption{Path on the XY plane}
\label{xsenvsysen30u}
\end{minipage}
\end{figure}

Then we compute our fitting algorithm on the x,y and z data.
\begin{table}[H]
\caption{Planefit coefficients} % title of Table
\centering % used for centering table
\begin{tabular}{c c c} % centered columns (4 columns)
\hline\hline %inserts double horizontal lines
$a_1$ & $a_2$ & $a_3$ \\ [0.5ex] % inserts table 
%heading
\hline % inserts single horizontal line
-0.14615  & -0.031882 & 29.537 \\[1ex]

\hline %inserts single line
\end{tabular}
\label{table:planefit} % is used to refer this table in the text
\end{table}


\begin{figure}[H]
  \centering
  \includegraphics[scale=0.4]{images/outputz.eps}
    \caption{Asylum}
  \label{outputz}
\end{figure}

The size of the scan is still 30 $\mu m$ and the spiral has 80 loops. The scan pattern we are going to send to the controller is generated with the previously computed planefit coefficients. 

\begin{figure}[H]
  \centering
  \includegraphics[scale=0.4]{images/spiralztiltout.eps}
    \caption{Input of the tilt compensation}
  \label{spiralztiltout}
\end{figure}

We have calibrated the small piezoelectric ceramic and found that a step of 5V is equal to 90 nm.
\begin{figure}[ht]
\begin{minipage}[b]{0.45\linewidth}
\centering
\includegraphics[width=\textwidth]{images/Calib1vPP_HeightMap.eps}
\caption{Height of the calibration}
\label{fig:figure1}
\end{minipage}
\hspace{0.5cm}
\begin{minipage}[b]{0.45\linewidth}
\centering
\includegraphics[width=\textwidth]{images/Calib1VppHisto.eps}
\caption{Histogram of the calibration}
\label{fig:figure2}
\end{minipage}
\end{figure}

The tilt compensation takes a load off the small fast piezoelectrical ceramics. The Figure ~\ref{spiralzfast} shows the efficiency of our method. Indeed, the fast piezo was previously saturating. The piezos was trying to reach features that are larger than his range. If we use the tilt correction, we see that our piezo has no problem reaching those features.


\begin{figure}[H]
  \centering
  \includegraphics[scale=0.4]{images/tiltcorrectiongraph.eps}
    \caption{Output of the fast piezo}
  \label{spiralzfast}
\end{figure}

We can see the effect of the tilt correction on the following figure.

\begin{figure}[ht]
\begin{minipage}[b]{0.45\linewidth}
\centering
\includegraphics[width=\textwidth]{images/TiltSession0226_27.png}
\caption{Before the tilt correction}
\label{tiltbefore}
\end{minipage}
\hspace{0.5cm}
\begin{minipage}[b]{0.45\linewidth}
\centering
\includegraphics[width=\textwidth]{images/TiltSession0226wc_35.png}
\caption{After the tilt correction}
\label{tiltafter}
\end{minipage}
\end{figure}

